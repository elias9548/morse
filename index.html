<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Septima Morze</title>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@300;400;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
html,body{height:100%;width:100%;overscroll-behavior:none}
:root{
  --accent:#7c5fff;--accent2:#b48cff;
  --text:rgba(232,228,255,1);--dim:rgba(200,185,255,.5);
  --ok:rgba(110,255,170,.95);--err:rgba(255,100,110,.95);
}
body{
  background:#07071a;font-family:'Space Mono',monospace;
  color:var(--text);overflow:hidden;position:fixed;inset:0;
}
#atm{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 90% 55% at 10% 0%,rgba(80,40,220,.3) 0%,transparent 65%),
    radial-gradient(ellipse 60% 55% at 90% 90%,rgba(140,60,255,.2) 0%,transparent 60%),
    radial-gradient(ellipse 50% 40% at 50% 50%,rgba(40,10,100,.3) 0%,transparent 100%);
}

/* SCREENS */
.screen{
  position:fixed;inset:0;z-index:1;
  display:flex;flex-direction:column;
  overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;
  padding:max(env(safe-area-inset-top),8px) 16px max(env(safe-area-inset-bottom),20px);
  transform:translateX(100%);
  transition:transform .33s cubic-bezier(.4,0,.2,1),opacity .33s;
  opacity:0;pointer-events:none;
}
.screen.active{transform:translateX(0);opacity:1;pointer-events:all}
.screen.leaving{transform:translateX(-48%);opacity:0;pointer-events:none}

/* GLASS */
.glass{
  position:relative;
  background:linear-gradient(135deg,rgba(255,255,255,.1) 0%,rgba(255,255,255,.03) 45%,rgba(100,60,220,.08) 100%);
  border:1px solid rgba(255,255,255,.13);border-radius:20px;
  backdrop-filter:blur(24px) saturate(1.8);-webkit-backdrop-filter:blur(24px) saturate(1.8);
  overflow:hidden;
}
.glass::before{
  content:'';position:absolute;top:0;left:0;right:0;height:1px;z-index:1;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,.6) 28%,rgba(180,140,255,.7) 62%,transparent);
}
.glass::after{
  content:'';position:absolute;top:0;left:-70%;width:38%;height:100%;
  background:linear-gradient(108deg,transparent,rgba(255,255,255,.05) 50%,transparent);
  transform:skewX(-14deg);pointer-events:none;
}

/* HOME */
#home{justify-content:center;align-items:center;gap:10px}
.logo-wrap{text-align:center;margin-bottom:20px}
.logo-name{
  font-family:'Unbounded',sans-serif;
  font-size:clamp(34px,9vw,50px);font-weight:900;line-height:1;letter-spacing:-.03em;
  background:linear-gradient(140deg,#fff 0%,#c8aaff 40%,#7c5fff 100%);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
  filter:drop-shadow(0 0 24px rgba(124,95,255,.5));
}
.logo-sub{
  font-family:'Unbounded',sans-serif;font-size:clamp(11px,3.2vw,15px);
  font-weight:300;letter-spacing:.26em;color:rgba(180,140,255,.5);margin-top:5px;
}

/* NAV BUTTONS ‚Äî icon + label in ONE ROW */
.nav-btn{
  width:100%;max-width:400px;
  padding:14px 18px;border-radius:18px;border:none;cursor:pointer;
  font-family:'Unbounded',sans-serif;letter-spacing:.02em;color:rgba(255,255,255,.92);
  text-align:left;transition:transform .14s,opacity .14s;
  position:relative;overflow:hidden;
  background:linear-gradient(135deg,rgba(255,255,255,.1) 0%,rgba(255,255,255,.03) 50%,rgba(110,70,230,.12) 100%);
  border:1px solid rgba(255,255,255,.13);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  box-shadow:0 4px 20px rgba(70,30,180,.2),inset 0 1px 0 rgba(255,255,255,.2);
}
.nav-btn::before{
  content:'';position:absolute;top:0;left:8%;right:8%;height:1px;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);
}
.nav-btn:active{transform:scale(.97);opacity:.82}
.nav-row{display:flex;align-items:center;gap:12px}
.nav-ico{font-size:22px;flex-shrink:0;line-height:1}
.nav-text{flex:1;min-width:0}
.nav-lbl{display:block;font-size:13px;font-weight:400;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.nav-desc{display:block;font-size:10px;color:var(--dim);font-family:'Space Mono',monospace;letter-spacing:.04em;margin-top:3px}

/* INNER HEADER */
.s-header{display:flex;align-items:center;gap:10px;padding-top:4px;padding-bottom:8px;flex-shrink:0}
.back{
  width:36px;height:36px;border-radius:50%;
  border:1px solid rgba(255,255,255,.13);background:rgba(255,255,255,.05);
  backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;
  cursor:pointer;color:var(--dim);flex-shrink:0;
}
.back:active{background:rgba(255,255,255,.12)}
.s-title{
  font-family:'Unbounded',sans-serif;font-size:14px;font-weight:400;
  background:linear-gradient(135deg,#fff,#b48cff);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}

/* CARDS */
.card{padding:13px 15px;margin-bottom:10px;flex-shrink:0}
.lbl{font-size:10px;color:var(--dim);letter-spacing:.1em;text-transform:uppercase;margin-bottom:5px}

/* WORD CHIPS */
.chips{display:flex;flex-wrap:wrap;gap:4px;min-height:22px;align-items:center}
.chip{font-size:10px;font-weight:700;letter-spacing:.08em;padding:2px 6px;border-radius:5px;color:var(--dim)}
.chip.active{color:#fff;background:rgba(124,95,255,.28);border:1px solid rgba(180,140,255,.45);text-shadow:0 0 10px rgba(180,140,255,.7);animation:cpulse 1.6s ease-in-out infinite}
.chip.done{color:rgba(110,255,170,.55);text-decoration:line-through}
@keyframes cpulse{0%,100%{box-shadow:none}50%{box-shadow:0 0 0 3px rgba(124,95,255,.15)}}

/* MORSE PILLS */
.pills{display:flex;gap:4px;flex-wrap:wrap;min-height:11px;align-items:center;margin-top:4px}
.pill{display:inline-block;background:rgba(180,140,255,.28);border:1px solid rgba(180,140,255,.4);border-radius:50px;animation:ppop .13s ease}
.pill.dot{width:8px;height:8px}
.pill.dash{width:20px;height:8px}
.pill-sp{display:inline-block;width:6px}
@keyframes ppop{0%{transform:scale(0);opacity:0}70%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}

/* RESULT */
.result{min-height:26px;font-size:15px;letter-spacing:.12em;color:rgba(180,255,160,.9);font-family:'Space Mono',monospace;word-break:break-all;line-height:1.6}
.cur{display:inline-block;width:2px;height:14px;background:rgba(180,255,160,.7);vertical-align:middle;margin-left:2px;animation:blink 1s step-end infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}

/* STATE MSG */
.smsg{font-size:11px;color:var(--dim);letter-spacing:.06em;text-align:center;min-height:16px;padding:2px 0}
.smsg.ok{color:var(--ok)}.smsg.err{color:var(--err)}

/* SCORE BAR */
.sbar{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:var(--dim);letter-spacing:.04em}
.sbar .v{color:var(--accent2);font-weight:700}

/* KEY BUTTON */
.key-wrap{display:flex;align-items:center;justify-content:center;flex-shrink:0}
.key-btn{
  position:relative;width:min(60vw,240px);aspect-ratio:1;border-radius:50%;
  cursor:pointer;user-select:none;-webkit-user-select:none;touch-action:none;
  transition:transform .08s ease;
  background:
    radial-gradient(ellipse 58% 34% at 37% 24%,rgba(255,255,255,.44) 0%,transparent 60%),
    radial-gradient(ellipse 28% 18% at 64% 14%,rgba(255,255,255,.24) 0%,transparent 50%),
    radial-gradient(ellipse 80% 80% at 50% 50%,rgba(100,60,255,.35) 0%,rgba(55,20,175,.6) 60%,rgba(18,8,70,.7) 100%);
  border:1px solid rgba(255,255,255,.2);
  box-shadow:0 0 48px rgba(100,60,255,.38),0 0 95px rgba(80,40,200,.17),inset 0 2px 20px rgba(255,255,255,.17),inset 0 -5px 24px rgba(15,0,70,.5),inset 0 0 0 1px rgba(255,255,255,.09);
  backdrop-filter:blur(36px) saturate(2) brightness(1.08);-webkit-backdrop-filter:blur(36px) saturate(2) brightness(1.08);
  display:flex;align-items:center;justify-content:center;
  font-family:'Unbounded',sans-serif;font-size:14px;font-weight:300;
  color:rgba(255,255,255,.9);letter-spacing:.06em;overflow:hidden;
}
.key-btn::before{content:'';position:absolute;top:7%;left:14%;width:54%;height:33%;border-radius:50%;background:linear-gradient(132deg,rgba(255,255,255,.55) 0%,rgba(200,175,255,.26) 42%,transparent 70%);filter:blur(4px);pointer-events:none}
.key-btn::after{content:'';position:absolute;bottom:11%;right:9%;width:27%;height:18%;border-radius:50%;background:radial-gradient(ellipse,rgba(180,140,255,.4) 0%,transparent 70%);filter:blur(5px);pointer-events:none}
.caustic{position:absolute;inset:-2px;border-radius:50%;pointer-events:none;background:conic-gradient(from 0deg,transparent 0deg,rgba(255,255,255,.14) 30deg,transparent 62deg,rgba(180,140,255,.18) 122deg,transparent 152deg,rgba(255,255,255,.1) 212deg,transparent 242deg,rgba(120,80,255,.14) 302deg,transparent 360deg);animation:cspin 8s linear infinite}
@keyframes cspin{to{transform:rotate(360deg)}}
.kf{position:absolute;inset:0;border-radius:50%;opacity:0;pointer-events:none;transition:opacity .06s}
.kf.dot{background:radial-gradient(circle,rgba(180,255,160,.3) 0%,transparent 70%)}
.kf.dash{background:radial-gradient(circle,rgba(255,185,80,.24) 0%,transparent 70%)}
.kf.on{opacity:1}
.klbl{position:relative;z-index:2;pointer-events:none}
.key-btn.pressed{transform:scale(.94);box-shadow:0 0 36px rgba(100,60,255,.6),0 0 70px rgba(80,40,200,.28),inset 0 4px 32px rgba(0,0,70,.62),inset 0 0 0 1px rgba(255,255,255,.14)}
.ripple{position:absolute;border-radius:50%;pointer-events:none;background:rgba(255,255,255,.14);transform:scale(0);animation:rip .6s ease-out forwards}
@keyframes rip{to{transform:scale(4);opacity:0}}
.key-sm{width:min(38vw,120px)!important}

/* GLASS BUTTONS */
.btn-row{display:flex;gap:8px;flex-shrink:0;margin-top:8px}
.gbtn{
  flex:1;padding:13px 8px;border-radius:50px;border:none;cursor:pointer;
  font-family:'Unbounded',sans-serif;font-size:12px;font-weight:400;letter-spacing:.02em;
  color:rgba(255,255,255,.92);-webkit-text-fill-color:rgba(255,255,255,.92);
  transition:transform .13s,opacity .13s;position:relative;overflow:hidden;
  background:linear-gradient(135deg,rgba(255,255,255,.1) 0%,rgba(255,255,255,.03) 50%,rgba(110,70,230,.13) 100%);
  border:1px solid rgba(255,255,255,.13);
  backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);
  box-shadow:0 3px 16px rgba(70,30,180,.18),inset 0 1px 0 rgba(255,255,255,.2);
}
.gbtn::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent)}
.gbtn:active{transform:scale(.95);opacity:.8}
.gbtn.pri{background:linear-gradient(135deg,rgba(124,95,255,.26) 0%,rgba(70,35,190,.38) 100%);border-color:rgba(180,140,255,.3);box-shadow:0 3px 18px rgba(100,60,255,.32),inset 0 1px 0 rgba(255,255,255,.2)}
.gbtn.go{background:linear-gradient(135deg,rgba(100,255,160,.14) 0%,rgba(40,170,90,.1) 100%);border-color:rgba(100,255,160,.28);color:rgba(180,255,200,.95);-webkit-text-fill-color:rgba(180,255,200,.95);box-shadow:0 3px 16px rgba(50,200,100,.18),inset 0 1px 0 rgba(100,255,160,.26)}
.gbtn.stop{background:linear-gradient(135deg,rgba(255,100,100,.18) 0%,rgba(180,40,40,.28) 100%);border-color:rgba(255,130,130,.28);box-shadow:0 3px 16px rgba(200,50,50,.18),inset 0 1px 0 rgba(255,255,255,.14)}

/* TX GRID */
.tx-btns{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:auto auto;gap:8px;flex-shrink:0;margin-top:8px}
.tx-start{grid-column:1;grid-row:1/span 2;padding:18px 8px;border-radius:18px;font-size:14px}
.tx-pw{grid-column:2;grid-row:1;font-size:10px;padding:10px 5px}
.tx-rep{grid-column:2;grid-row:2}

/* PROGRESS */
.prog{height:3px;border-radius:2px;background:rgba(255,255,255,.06);margin-bottom:8px;overflow:hidden;flex-shrink:0}
.prog-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .4s ease;box-shadow:0 0 6px rgba(124,95,255,.5)}

/* COLORED LETTER INPUT */
.rl-input-wrap{
  position:relative;border-radius:14px;
  border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);
  backdrop-filter:blur(14px);cursor:text;
  transition:border-color .2s,box-shadow .2s;
}
.rl-input-wrap:focus-within{border-color:rgba(180,140,255,.4);box-shadow:0 0 0 2px rgba(124,95,255,.15)}
.rl-input-wrap.ok{border-color:rgba(100,255,160,.4);box-shadow:0 0 0 2px rgba(100,255,160,.12)}
.rl-input-wrap.err{border-color:rgba(255,100,100,.4);box-shadow:0 0 0 2px rgba(255,100,100,.12)}
.rl-colored-display{
  min-height:50px;padding:12px 14px;
  font-family:'Space Mono',monospace;font-size:18px;font-weight:700;letter-spacing:.18em;
  text-transform:uppercase;line-height:1.4;
  display:flex;align-items:center;flex-wrap:wrap;gap:1px;
}
.rl-colored-display:empty::before{
  content:'–í–í–ï–î–ò –°–õ–û–í–û';color:rgba(255,255,255,.14);letter-spacing:.18em;font-size:18px;
}
.rl-ch-ok{color:rgba(110,255,170,.95)}
.rl-ch-err{color:rgba(255,100,110,.95)}
.rl-ch-cur{
  display:inline-block;width:2px;height:20px;
  background:rgba(180,140,255,.8);vertical-align:middle;margin-left:1px;
  animation:blink 1s step-end infinite;
}
.rl-hidden-inp{
  position:absolute;opacity:0;width:1px;height:1px;top:0;left:0;
  font-size:16px;border:none;outline:none;background:transparent;
}

/* LETTER INPUT */
.linput{
  width:100%;padding:12px 14px;border-radius:14px;
  border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);
  backdrop-filter:blur(14px);
  font-family:'Space Mono',monospace;font-size:18px;font-weight:700;letter-spacing:.18em;
  color:rgba(190,255,170,.95);-webkit-text-fill-color:rgba(190,255,170,.95);
  text-transform:uppercase;outline:none;
  transition:border-color .2s,box-shadow .2s;-webkit-appearance:none;
}
.linput::placeholder{color:rgba(255,255,255,.14);-webkit-text-fill-color:rgba(255,255,255,.14)}
.linput:focus{border-color:rgba(180,140,255,.4);box-shadow:0 0 0 2px rgba(124,95,255,.15)}
.linput.ok{border-color:rgba(100,255,160,.4);box-shadow:0 0 0 2px rgba(100,255,160,.12);-webkit-text-fill-color:var(--ok)}
.linput.err{border-color:rgba(255,100,100,.4);box-shadow:0 0 0 2px rgba(255,100,100,.12)}

/* PLAY BUTTON */
.play-wrap{display:flex;justify-content:center;padding:6px 0;flex-shrink:0}
.play-btn{
  display:flex;align-items:center;gap:9px;padding:12px 26px;border-radius:50px;border:none;cursor:pointer;
  font-family:'Unbounded',sans-serif;font-size:13px;color:#fff;-webkit-text-fill-color:#fff;
  background:linear-gradient(135deg,rgba(100,60,255,.38) 0%,rgba(55,15,175,.48) 100%);
  border:1px solid rgba(180,140,255,.3);
  box-shadow:0 4px 20px rgba(100,60,255,.36),inset 0 1px 0 rgba(255,255,255,.18);
  backdrop-filter:blur(12px);transition:transform .13s,opacity .13s;position:relative;overflow:hidden;
}
.play-btn::before{content:'';position:absolute;top:0;left:8%;right:8%;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.48),transparent)}
.play-btn:active{transform:scale(.95);opacity:.85}
.play-btn.playing{background:linear-gradient(135deg,rgba(255,175,70,.26) 0%,rgba(200,95,20,.36) 100%);border-color:rgba(255,175,70,.35);box-shadow:0 4px 20px rgba(255,150,40,.3),inset 0 1px 0 rgba(255,255,255,.13)}

/* REFERENCE */
.ref-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:7px;padding-bottom:20px}
.ref-card{padding:9px 6px;border-radius:13px;text-align:center;background:linear-gradient(135deg,rgba(255,255,255,.07) 0%,rgba(110,70,230,.06) 100%);border:1px solid rgba(255,255,255,.09);backdrop-filter:blur(12px);position:relative;overflow:hidden}
.ref-card::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.38),transparent)}
.ref-letter{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:700;color:#fff;line-height:1;margin-bottom:5px}
.ref-pills{display:flex;justify-content:center;gap:3px;flex-wrap:wrap;min-height:8px}
.rp-dot{width:5px;height:5px;border-radius:50%;background:rgba(180,140,255,.7)}
.rp-dash{width:14px;height:5px;border-radius:50px;background:rgba(180,140,255,.7)}
.ref-code{font-size:9px;color:var(--dim);letter-spacing:.04em;margin-top:3px}

/* COMBO */
.combo-sec{padding:12px 14px;margin-bottom:8px;flex-shrink:0}
.combo-lbl{font-size:10px;color:var(--dim);letter-spacing:.1em;text-transform:uppercase;text-align:center;margin-bottom:7px}

/* RL WORD ROWS */
.rl-row{
  display:flex;align-items:center;gap:10px;padding:9px 13px;border-radius:14px;
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);
  transition:background .2s,border-color .2s;flex-shrink:0;
}
.rl-row.active{background:rgba(124,95,255,.12);border-color:rgba(180,140,255,.3);}
.rl-row.done-ok{border-color:rgba(100,255,160,.2);background:rgba(100,255,160,.05)}
.rl-row.done-err{border-color:rgba(255,100,100,.2);background:rgba(255,100,100,.05)}
.rl-row.skipped{opacity:.45}
.rl-num{font-size:10px;color:var(--dim);min-width:14px;text-align:right;flex-shrink:0}
.rl-morse{display:flex;flex-wrap:wrap;gap:6px;align-items:center;flex:1}
.rl-letter-grp{display:flex;flex-direction:column;align-items:center;gap:3px}
.rl-letter-pills{display:flex;gap:3px;align-items:center}
.rl-letter-ch{font-size:11px;font-weight:700;font-family:'Space Mono',monospace;line-height:1;color:var(--dim)}
.rl-letter-ch.ok{color:rgba(110,255,170,.9)}
.rl-letter-ch.err{color:rgba(255,100,110,.9)}
.rl-sep{width:1px;height:16px;background:rgba(255,255,255,.07);flex-shrink:0}

/* MORSE DISPLAY (rl screen) */
.rl-morse-display{
  display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start;padding:10px 4px;min-height:44px;
}
.rl-char-group{display:flex;flex-direction:column;align-items:center;gap:5px}
.rl-char-pills{display:flex;gap:4px;align-items:center}

@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-7px)}40%{transform:translateX(7px)}60%{transform:translateX(-5px)}80%{transform:translateX(4px)}}
.shake{animation:shake .38s ease}
.sp{height:8px;flex-shrink:0}
</style>
</head>
<body>
<div id="atm"></div>

<!-- HOME -->
<div id="home" class="screen active">
  <div class="logo-wrap">
    <div class="logo-name">Septima</div>
    <div class="logo-sub">¬∑ ¬∑ ¬∑ M o r s e ¬∑ ¬∑ ¬∑</div>
  </div>
  <button class="nav-btn" onclick="go('transmit')">
    <div class="nav-row"><span class="nav-ico">‚†ø</span><span class="nav-text"><span class="nav-lbl">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏</span><span class="nav-desc">–¢–∞–ø ‚Äî —Ç–æ—á–∫–∞ ¬∑ –£–¥–µ—Ä–∂–∞–Ω–∏–µ ‚Äî —Ç–∏—Ä–µ</span></span></div>
  </button>
  <button class="nav-btn" onclick="go('reference')">
    <div class="nav-row"><span class="nav-ico">üìñ</span><span class="nav-text"><span class="nav-lbl">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</span><span class="nav-desc">–í–µ—Å—å –∞–ª—Ñ–∞–≤–∏—Ç –≤ –º–æ—Ä–∑–µ</span></span></div>
  </button>
  <button class="nav-btn" onclick="go('rl')">
    <div class="nav-row"><span class="nav-ico">üëÅÔ∏è</span><span class="nav-text"><span class="nav-lbl">–ü—Ä–∏—ë–º –±—É–∫–≤–∞–º–∏</span><span class="nav-desc">–°–º–æ—Ç—Ä–∏ —Å–∏–º–≤–æ–ª—ã ‚Üí –Ω–∞–±–∏—Ä–∞–π —Ç–µ–∫—Å—Ç</span></span></div>
  </button>
  <button class="nav-btn" onclick="go('rm')">
    <div class="nav-row"><span class="nav-ico">üîë</span><span class="nav-text"><span class="nav-lbl">–ü—Ä–∏—ë–º –º–æ—Ä–∑–µ</span><span class="nav-desc">–°–ª—É—à–∞–π ‚Üí –ø–æ–≤—Ç–æ—Ä–∏ –∫–ª—é—á–æ–º</span></span></div>
  </button>
  <button class="nav-btn" onclick="go('rc')">
    <div class="nav-row"><span class="nav-ico">‚ö°</span><span class="nav-text"><span class="nav-lbl">–ü—Ä–∏—ë–º –∫–æ–º–±–æ</span><span class="nav-desc">–ö–ª—é—á + –ø–µ—Ä–µ–≤–æ–¥ –±—É–∫–≤–∞–º–∏</span></span></div>
  </button>
</div>

<!-- TRANSMIT -->
<div id="transmit" class="screen">
  <div class="s-header">
    <div class="back" onclick="go('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></div>
    <span class="s-title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏</span>
  </div>
  <div class="card glass">
    <div class="lbl">–°–ª–æ–≤–∞</div>
    <div class="chips" id="tx-chips"></div>
    <div class="sp"></div>
    <div class="lbl">–í–≤–æ–¥</div>
    <div class="result" id="tx-result"><span class="cur"></span></div>
    <div class="pills" id="tx-pills"></div>
    <div class="sp"></div>
    <div class="sbar">
      <span>–°–ª–æ–≤: <span class="v" id="tx-sw">0</span></span>
      <div class="smsg" id="tx-msg">–ù–∞–∂–º–∏ –°–¢–ê–†–¢</div>
      <span>–ë—É–∫–≤: <span class="v" id="tx-sc">0</span></span>
    </div>
  </div>
  <div class="key-wrap" style="flex:1;min-height:190px;padding:10px 0">
    <div class="key-btn" id="tx-key">
      <div class="caustic"></div>
      <div class="kf dot"></div><div class="kf dash"></div>
      <span class="klbl">–ö–ª—é—á</span>
    </div>
  </div>
  <div class="tx-btns">
    <button class="gbtn pri tx-start" id="tx-sbtn" onclick="txToggle()">–°–¢–ê–†–¢</button>
    <button class="gbtn tx-pw" onclick="txPrev()">‚Üê –ü—Ä–µ–¥. —Å–ª–æ–≤–æ</button>
    <button class="gbtn tx-rep" onclick="txRepeat()">–ü–æ–≤—Ç–æ—Ä</button>
  </div>
</div>

<!-- REFERENCE -->
<div id="reference" class="screen">
  <div class="s-header">
    <div class="back" onclick="go('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></div>
    <span class="s-title">–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫</span>
  </div>
  <div class="ref-grid" id="ref-grid"></div>
</div>

<!-- RECV LETTERS -->
<div id="rl" class="screen">
  <div class="s-header">
    <div class="back" onclick="go('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></div>
    <span class="s-title">–ü—Ä–∏—ë–º –±—É–∫–≤–∞–º–∏</span>
  </div>
  <div class="prog" style="margin-bottom:6px;flex-shrink:0"><div class="prog-fill" id="rl-prog" style="width:0%"></div></div>
  <div id="rl-list" style="flex:1;display:flex;flex-direction:column;gap:7px;padding-bottom:8px;flex-shrink:0"></div>
  <div class="smsg" id="rl-msg" style="flex-shrink:0;padding:4px 0">–†–∞—Å—à–∏—Ñ—Ä—É–π –∏ –≤–≤–µ–¥–∏ —Å–ª–æ–≤–æ</div>
  <div class="card glass" style="flex-shrink:0;margin-top:4px">
    <div class="lbl">–û—Ç–≤–µ—Ç –±—É–∫–≤–∞–º–∏</div>
    <div class="rl-input-wrap">
      <div class="rl-colored-display" id="rl-colored"></div>
      <input class="rl-hidden-inp" id="rl-inp" type="text" inputmode="text" autocomplete="off" autocorrect="off" autocapitalize="characters" spellcheck="false">
    </div>
  </div>
  <div class="btn-row" style="flex-shrink:0">
    <button class="gbtn" onclick="rlSkip()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    <button class="gbtn go" onclick="rlCheck()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ‚úì</button>
  </div>
  <div class="sp"></div>
  <div class="btn-row" style="flex-shrink:0"><button class="gbtn" onclick="rlInit()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button></div>
</div>

<!-- RECV MORSE -->
<div id="rm" class="screen">
  <div class="s-header">
    <div class="back" onclick="go('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></div>
    <span class="s-title">–ü—Ä–∏—ë–º –º–æ—Ä–∑–µ</span>
  </div>
  <div class="card glass">
    <div class="lbl">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
    <div class="prog"><div class="prog-fill" id="rm-prog" style="width:0%"></div></div>
    <div class="chips" id="rm-chips"></div>
    <div class="sp"></div>
    <div class="lbl">–¢–≤–æ–π –≤–≤–æ–¥ –∫–ª—é—á–æ–º</div>
    <div class="pills" id="rm-pills"></div>
    <div class="result" style="font-size:13px;min-height:20px;margin-top:3px" id="rm-dec"></div>
    <div class="smsg" id="rm-msg">–ù–∞–∂–º–∏ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</div>
  </div>
  <div class="play-wrap">
    <button class="play-btn" id="rm-pbtn" onclick="rmPlay()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
    </button>
  </div>
  <div class="key-wrap" style="flex:1;min-height:175px;padding:10px 0">
    <div class="key-btn" id="rm-key">
      <div class="caustic"></div>
      <div class="kf dot"></div><div class="kf dash"></div>
      <span class="klbl">–ö–ª—é—á</span>
    </div>
  </div>
  <div class="btn-row">
    <button class="gbtn" onclick="rmClear()">–û—á–∏—Å—Ç–∏—Ç—å</button>
    <button class="gbtn go" onclick="rmCheck()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ‚úì</button>
  </div>
  <div class="sp"></div>
  <div class="btn-row"><button class="gbtn" onclick="rmInit()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button></div>
</div>

<!-- RECV COMBO -->
<div id="rc" class="screen">
  <div class="s-header">
    <div class="back" onclick="go('home')"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></div>
    <span class="s-title">–ü—Ä–∏—ë–º –∫–æ–º–±–æ</span>
  </div>
  <div class="card glass">
    <div class="lbl">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
    <div class="prog"><div class="prog-fill" id="rc-prog" style="width:0%"></div></div>
    <div class="chips" id="rc-chips"></div>
    <div class="smsg" id="rc-msg">–ù–∞–∂–º–∏ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</div>
  </div>
  <div class="play-wrap">
    <button class="play-btn" id="rc-pbtn" onclick="rcPlay()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
    </button>
  </div>
  <div class="combo-sec glass">
    <div class="combo-lbl">‚ë† –í–≤–µ–¥–∏ –º–æ—Ä–∑–µ –∫–ª—é—á–æ–º</div>
    <div class="pills" id="rc-pills"></div>
    <div class="result" style="font-size:12px;min-height:16px;margin-top:3px" id="rc-mdec"></div>
    <div style="display:flex;justify-content:center;margin-top:10px">
      <div class="key-btn key-sm" id="rc-key">
        <div class="caustic"></div>
        <div class="kf dot"></div><div class="kf dash"></div>
        <span class="klbl" style="font-size:10px">–ö–ª—é—á</span>
      </div>
    </div>
    <div class="sp"></div>
    <div class="btn-row"><button class="gbtn" style="font-size:10px;padding:8px" onclick="rcClear()">–û—á–∏—Å—Ç–∏—Ç—å –º–æ—Ä–∑–µ</button></div>
  </div>
  <div class="combo-sec glass">
    <div class="combo-lbl">‚ë° –ü–µ—Ä–µ–≤–µ–¥–∏ –±—É–∫–≤–∞–º–∏</div>
    <input class="linput" id="rc-inp" type="text" inputmode="text" autocomplete="off" autocorrect="off" autocapitalize="characters" spellcheck="false" placeholder="–í–í–ï–î–ò –°–õ–û–í–û">
  </div>
  <div class="btn-row">
    <button class="gbtn" onclick="rcSkip()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
    <button class="gbtn go" onclick="rcCheck()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ‚úì</button>
  </div>
  <div class="sp"></div>
  <div class="btn-row"><button class="gbtn" onclick="rcInit()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button></div>
</div>

<script>
'use strict';
// ‚îÄ‚îÄ MORSE TABLE ‚îÄ‚îÄ
const MRU={
  '–ê':'.-','–ë':'-...','–í':'.--','–ì':'--.','–î':'-..','–ï':'.','–ñ':'...-','–ó':'--..',
  '–ò':'..','–ô':'.---','–ö':'-.-','–õ':'.-..','–ú':'--','–ù':'-.','–û':'---','–ü':'.--.',
  '–†':'.-.','–°':'...','–¢':'-','–£':'..-','–§':'..-.','–•':'....','–¶':'-.-.','–ß':'---.',
  '–®':'----','–©':'--.-','–™':'--.--','–´':'-.--','–¨':'-..-','–≠':'..-..','–Æ':'..--','–Ø':'.-.-',
  '1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...',
  '8':'---..','9':'----.','0':'-----'
};
const REV=Object.fromEntries(Object.entries(MRU).map(([k,v])=>[v,k]));

const SETS=[
  ['–†–ê–î–ò–û','–í–û–õ–ù–ê','–ú–ê–Ø–ö','–ú–û–†–ï','–ë–ï–†–ï–ì','–°–ò–ì–ù–ê–õ','–ö–õ–Æ–ß','–°–í–Ø–ó–¨','–ê–ù–¢–ï–ù–ù–ê','–≠–§–ò–†'],
  ['–¢–û–ß–ö–ê','–¢–ò–†–ï','–ö–û–î','–ó–ù–ê–ö','–ü–ê–£–ó–ê','–†–ò–¢–ú','–¢–ï–ö–°–¢','–ü–†–ò–ï–ú','–ß–ê–°–¢–û–¢–ê','–î–ò–ê–ü–ê–ó–û–ù'],
  ['–ù–ï–ë–û','–ó–í–ï–ó–î–ê','–õ–£–ù–ê','–ó–ï–ú–õ–Ø','–û–ö–ï–ê–ù','–í–ï–¢–ï–†','–ì–†–û–ó–ê','–¢–£–ú–ê–ù','–†–ê–°–°–í–ï–¢','–ì–û–†–ò–ó–û–ù–¢'],
];
const rndSet=()=>[...SETS[Math.floor(Math.random()*SETS.length)]];

// ‚îÄ‚îÄ AUDIO ‚îÄ‚îÄ
let _ac=null;
function getAC(){
  if(!_ac)_ac=new(window.AudioContext||window.webkitAudioContext)();
  if(_ac.state==='suspended')_ac.resume();
  return _ac;
}
function beep(durSec,freq=700){
  return new Promise(res=>{
    try{
      const a=getAC(),o=a.createOscillator(),g=a.createGain();
      o.connect(g);g.connect(a.destination);
      o.type='sine';o.frequency.value=freq;
      const t=a.currentTime;
      g.gain.setValueAtTime(0,t);
      g.gain.linearRampToValueAtTime(.3,t+.01);
      g.gain.linearRampToValueAtTime(.3,t+durSec-.01);
      g.gain.linearRampToValueAtTime(0,t+durSec);
      o.start(t);o.stop(t+durSec);
    }catch(e){}
    setTimeout(res,durSec*1000);
  });
}
const wait=ms=>new Promise(r=>setTimeout(r,ms));
let ABORT=false;

async function playWord(word){
  ABORT=false;
  const U=100;
  let firstCh=true;
  for(const ch of word){
    if(ABORT)return;
    const code=MRU[ch];if(!code)continue;
    if(!firstCh)await wait(U*3);firstCh=false;
    let firstSym=true;
    for(const s of code){
      if(ABORT)return;
      if(!firstSym)await wait(U);firstSym=false;
      if(s==='.')await beep(U/1000,700);
      else await beep(U*3/1000,680);
    }
  }
}

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
let curScr='home';
function go(to){
  if(to===curScr)return;
  ABORT=true;
  const fromEl=document.getElementById(curScr);
  const toEl=document.getElementById(to);
  fromEl.classList.add('leaving');
  toEl.classList.add('active');
  toEl.scrollTop=0;
  setTimeout(()=>fromEl.classList.remove('active','leaving'),360);
  curScr=to;
  ({transmit:txInit,reference:refBuild,rl:rlInit,rm:rmInit,rc:rcInit})[to]?.();
}

// ‚îÄ‚îÄ KEY HELPER ‚îÄ‚îÄ
const THRESH=100;
function attachKey(el,onDot,onDash){
  if(el._attached)return;
  el._attached=true;
  let t0=0,down=false;
  function dn(e){
    e.preventDefault();getAC();
    t0=Date.now();down=true;
    el.classList.add('pressed');
  }
  function up(e){
    e.preventDefault();
    if(!down)return;down=false;
    el.classList.remove('pressed');
    const dur=Date.now()-t0;
    // ripple
    const r=document.createElement('div');
    r.className='ripple';
    r.style.cssText='width:70px;height:70px;left:calc(50% - 35px);top:calc(50% - 35px)';
    el.appendChild(r);setTimeout(()=>r.remove(),700);
    if(dur<THRESH){kFlash(el,'dot');beep(.08,700);onDot();}
    else{kFlash(el,'dash');beep(.22,680);onDash();}
  }
  function cancel(){down=false;el.classList.remove('pressed')}
  el.addEventListener('mousedown',dn,{passive:false});
  el.addEventListener('mouseup',up,{passive:false});
  el.addEventListener('mouseleave',cancel);
  el.addEventListener('touchstart',dn,{passive:false});
  el.addEventListener('touchend',up,{passive:false});
  el.addEventListener('touchcancel',cancel,{passive:false});
}
function kFlash(el,type){
  const kf=el.querySelector('.kf.'+type);if(!kf)return;
  kf.classList.add('on');setTimeout(()=>kf.classList.remove('on'),200);
}

// ‚îÄ‚îÄ RENDER HELPERS ‚îÄ‚îÄ
function rChips(id,words,ai){
  const el=document.getElementById(id);el.innerHTML='';
  words.forEach((w,i)=>{
    const c=document.createElement('span');
    c.className='chip'+(i===ai?' active':i<ai?' done':'');
    c.textContent=w;el.appendChild(c);
  });
}
function rPills(id,str){
  const el=document.getElementById(id);el.innerHTML='';
  for(const c of str){
    if(c==='.'||c==='-'){const p=document.createElement('span');p.className='pill '+(c==='.'?'dot':'dash');el.appendChild(p);}
    else if(c===' '){const s=document.createElement('span');s.className='pill-sp';el.appendChild(s);}
  }
}
function wordMorse(w){return w.split('').map(c=>MRU[c]||'').join(' ')}
function decodeMorse(s){return s.trim().split(' ').map(p=>REV[p]||(p?'?':'')).join('')}
const PI='<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg>';
const SI='<svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><rect x="5" y="4" width="4" height="16"/><rect x="15" y="4" width="4" height="16"/></svg>';
function pbIdle(id,lbl='–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏'){const b=document.getElementById(id);b.classList.remove('playing');b.innerHTML=PI+' '+lbl;}
function pbBusy(id){const b=document.getElementById(id);b.classList.add('playing');b.innerHTML=SI+' –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ...'}
function setMsg(id,txt,cls=''){const el=document.getElementById(id);el.textContent=txt;el.className='smsg'+(cls?' '+cls:'')}

// ‚îÄ‚îÄ REFERENCE ‚îÄ‚îÄ
function refBuild(){
  const g=document.getElementById('ref-grid');if(g.children.length)return;
  ['–ê','–ë','–í','–ì','–î','–ï','–ñ','–ó','–ò','–ô','–ö','–õ','–ú','–ù','–û','–ü','–†','–°','–¢','–£','–§','–•','–¶','–ß','–®','–©','–™','–´','–¨','–≠','–Æ','–Ø','0','1','2','3','4','5','6','7','8','9'].forEach(l=>{
    const code=MRU[l];if(!code)return;
    const card=document.createElement('div');card.className='ref-card';
    const ps=code.split('').map(c=>c==='.'?'<div class="rp-dot"></div>':'<div class="rp-dash"></div>').join('');
    card.innerHTML=`<div class="ref-letter">${l}</div><div class="ref-pills">${ps}</div><div class="ref-code">${code}</div>`;
    g.appendChild(card);
  });
}

// ‚îÄ‚îÄ TRANSMIT ‚îÄ‚îÄ
let txW=[],txI=0,txOn=false,txMorse='',txLetters=[],txDone=[],txTimer=null;

function txInit(){
  clearTimeout(txTimer);txOn=false;
  txW=rndSet();txI=0;txMorse='';txLetters=[];txDone=[];
  setTxBtn(false);
  rChips('tx-chips',txW,-1);
  document.getElementById('tx-result').innerHTML='<span class="cur"></span>';
  rPills('tx-pills','');
  setMsg('tx-msg','–ù–∞–∂–º–∏ –°–¢–ê–†–¢');
  document.getElementById('tx-sw').textContent='0';
  document.getElementById('tx-sc').textContent='0';
  attachKey(document.getElementById('tx-key'),
    ()=>{if(txOn)txAdd('.')},
    ()=>{if(txOn)txAdd('-')}
  );
}
function setTxBtn(on){
  const b=document.getElementById('tx-sbtn');
  b.textContent=on?'–°–¢–û–ü':'–°–¢–ê–†–¢';
  b.className='gbtn tx-start '+(on?'stop':'pri');
}
function txToggle(){
  getAC();
  if(!txOn){txOn=true;setTxBtn(true);rChips('tx-chips',txW,txI);setMsg('tx-msg','–ü–µ—Ä–µ–¥–∞–≤–∞–π!');}
  else{txOn=false;clearTimeout(txTimer);setTxBtn(false);setMsg('tx-msg','–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');}
}
function txAdd(s){
  txMorse+=s;rPills('tx-pills',txMorse);
  const t=txW[txI],ci=txLetters.length;
  if(ci<t.length)setMsg('tx-msg',t[ci]+' : '+(MRU[t[ci]]||''));
  clearTimeout(txTimer);txTimer=setTimeout(txCharDone,450);
}
function txCharDone(){
  if(!txMorse||!txOn)return;
  const decoded=REV[txMorse]||'?';
  const t=txW[txI],expected=t[txLetters.length]||'';
  txLetters.push({ch:decoded,ok:decoded===expected});
  txMorse='';rPills('tx-pills','');txRender();txScore();
  if(txLetters.length>=t.length){
    const allOk=txLetters.every(l=>l.ok);
    txDone.push({w:t,ls:[...txLetters]});txLetters=[];txI++;
    rChips('tx-chips',txW,txI);txScore();
    if(txI>=txW.length){txOn=false;setTxBtn(false);setMsg('tx-msg','üéâ –í—Å—ë –ø–µ—Ä–µ–¥–∞–Ω–æ!');}
    else setMsg('tx-msg',allOk?'‚úì –í–µ—Ä–Ω–æ!':'‚úó –ù–µ–≤–µ—Ä–Ω–æ. –°–ª–µ–¥—É—é—â–µ–µ ‚Üí');
  }
}
function txRender(){
  const dH=txDone.map(d=>d.ls.map(l=>`<span style="color:${l.ok?'rgba(130,255,150,.9)':'rgba(255,90,100,.9)'}">${l.ch}</span>`).join('')).join('<span style="opacity:.3"> </span>');
  const cH=txLetters.map(l=>`<span style="color:${l.ok?'rgba(130,255,150,.9)':'rgba(255,90,100,.9)'}">${l.ch}</span>`).join('');
  const sep=dH&&cH?'<span style="opacity:.3"> </span>':'';
  document.getElementById('tx-result').innerHTML=dH+sep+cH+'<span class="cur"></span>';
}
function txScore(){
  document.getElementById('tx-sw').textContent=txI;
  document.getElementById('tx-sc').textContent=txDone.reduce((a,d)=>a+d.ls.length,0)+txLetters.length;
}
function txPrev(){
  if(!txOn)return;
  clearTimeout(txTimer);txMorse='';rPills('tx-pills','');
  if(txLetters.length>0){txLetters=[];txRender();}
  else if(txDone.length>0&&txI>0){txI--;txDone.pop();txLetters=[];rChips('tx-chips',txW,txI);txRender();txScore();}
}
function txRepeat(){
  if(!txOn){txToggle();return;}
  clearTimeout(txTimer);txI=0;txMorse='';txLetters=[];txDone=[];
  rChips('tx-chips',txW,txI);txRender();txScore();setMsg('tx-msg','–ü–æ–≤—Ç–æ—Ä!');
}

// ‚îÄ‚îÄ RECV LETTERS ‚îÄ‚îÄ
let rlW=[],rlI=0,rlResults=[];
function rlInit(){
  ABORT=true;rlW=rndSet();rlI=0;rlResults=[];
  const i=document.getElementById('rl-inp');i.value='';
  document.getElementById('rl-colored').innerHTML='';
  document.querySelector('.rl-input-wrap').className='rl-input-wrap';
  setMsg('rl-msg','–†–∞—Å—à–∏—Ñ—Ä—É–π –∏ –≤–≤–µ–¥–∏ —Å–ª–æ–≤–æ');
  document.getElementById('rl-prog').style.width='0%';
  rlBuildList();
}
function rlMorsePills(code){
  return code.split('').map(s=>`<span class="pill ${s==='.'?'dot':'dash'}" style="display:inline-block"></span>`).join('');
}
function rlBuildList(){
  const el=document.getElementById('rl-list');el.innerHTML='';
  rlW.forEach((word,idx)=>{
    const row=document.createElement('div');
    row.className='rl-row'+(idx===rlI?' active':idx<rlI?' done-'+(rlResults[idx]||'ok'):'');
    row.id='rl-row-'+idx;
    // number
    const num=document.createElement('span');num.className='rl-num';num.textContent=(idx+1)+'.';
    row.appendChild(num);
    // morse groups
    const morseDiv=document.createElement('div');morseDiv.className='rl-morse';
    word.split('').forEach((ch,ci)=>{
      if(ci>0){const sep=document.createElement('div');sep.className='rl-sep';morseDiv.appendChild(sep);}
      const grp=document.createElement('div');grp.className='rl-letter-grp';
      const pills=document.createElement('div');pills.className='rl-letter-pills';
      pills.innerHTML=rlMorsePills(MRU[ch]||'');
      grp.appendChild(pills);
      // letter result (shown after check)
      if(idx<rlI&&rlResults[idx]){
        const ans=rlResults[idx];
        const chEl=document.createElement('div');chEl.className='rl-letter-ch';
        const ansChar=typeof ans==='object'?ans.letters[ci]:null;
        if(ansChar!==undefined){
          chEl.textContent=ansChar.ch;
          chEl.classList.add(ansChar.ok?'ok':'err');
        } else {
          chEl.textContent='?';chEl.classList.add('err');
        }
        grp.appendChild(chEl);
      }
      morseDiv.appendChild(grp);
    });
    row.appendChild(morseDiv);
    el.appendChild(row);
  });
}
function rlCheck(){
  const inp=document.getElementById('rl-inp');
  const wrap=document.querySelector('.rl-input-wrap');
  const ans=inp.value.trim().toUpperCase().replace(/[^–ê-–Ø–Å]/g,'');
  const tgt=rlW[rlI];
  if(!ans){setMsg('rl-msg','–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç!','err');return;}
  const letters=[];
  for(let i=0;i<tgt.length;i++){
    letters.push({ch:ans[i]||'_',ok:ans[i]===tgt[i]});
  }
  const allOk=ans===tgt;
  rlResults[rlI]={letters,ok:allOk};
  wrap.className='rl-input-wrap '+(allOk?'ok':'err');
  setMsg('rl-msg',allOk?'‚úì –í–µ—Ä–Ω–æ!':'‚úó '+tgt,allOk?'ok':'err');
  setTimeout(()=>{rlI++;rlNext();},allOk?900:1800);
}
function rlSkip(){
  rlResults[rlI]='skipped';
  const row=document.getElementById('rl-row-'+rlI);if(row)row.classList.add('skipped');
  setMsg('rl-msg','–ü—Ä–æ–ø—É—â–µ–Ω–æ: '+rlW[rlI],'err');
  rlI++;setTimeout(rlNext,1100);
}
function rlNext(){
  const i=document.getElementById('rl-inp');i.value='';
  document.getElementById('rl-colored').innerHTML='';
  document.querySelector('.rl-input-wrap').className='rl-input-wrap';
  document.getElementById('rl-prog').style.width=(rlI/rlW.length*100)+'%';
  rlBuildList();
  if(rlI>=rlW.length){setMsg('rl-msg','üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ!','ok');return;}
  setMsg('rl-msg','–†–∞—Å—à–∏—Ñ—Ä—É–π –∏ –≤–≤–µ–¥–∏ —Å–ª–æ–≤–æ');
  setTimeout(()=>{
    const r=document.getElementById('rl-row-'+rlI);if(r)r.scrollIntoView({behavior:'smooth',block:'nearest'});
    document.getElementById('rl-inp').focus();
  },80);
}
document.getElementById('rl-inp').addEventListener('input',function(){
  this.value=this.value.toUpperCase().replace(/[^–ê-–Ø–Å]/g,'');
  rlRenderColored(this.value);
});
document.getElementById('rl-inp').addEventListener('focus',()=>{
  document.getElementById('rl-colored').classList.add('focused');
});
document.getElementById('rl-inp').addEventListener('blur',()=>{
  document.getElementById('rl-colored').classList.remove('focused');
});
document.querySelector('.rl-input-wrap').addEventListener('click',()=>{
  document.getElementById('rl-inp').focus();
});
function rlRenderColored(val){
  const tgt=rlW[rlI]||'';
  const display=document.getElementById('rl-colored');
  let html='';
  for(let i=0;i<val.length;i++){
    const ch=val[i];
    const ok=tgt[i]&&ch===tgt[i];
    html+=`<span class="${ok?'rl-ch-ok':'rl-ch-err'}">${ch}</span>`;
  }
  html+='<span class="rl-ch-cur"></span>';
  display.innerHTML=html;
}

// ‚îÄ‚îÄ RECV MORSE ‚îÄ‚îÄ
let rmW=[],rmI=0,rmM='',rmT=null;
function rmInit(){
  ABORT=true;clearTimeout(rmT);rmW=rndSet();rmI=0;rmM='';
  rChips('rm-chips',rmW,rmI);
  rPills('rm-pills','');document.getElementById('rm-dec').textContent='';
  setMsg('rm-msg','–ù–∞–∂–º–∏ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏');
  document.getElementById('rm-prog').style.width='0%';
  pbIdle('rm-pbtn');
  attachKey(document.getElementById('rm-key'),()=>rmAdd('.'),()=>rmAdd('-'));
}
async function rmPlay(){
  if(rmI>=rmW.length)return;
  ABORT=false;pbBusy('rm-pbtn');setMsg('rm-msg','–°–ª—É—à–∞–π...');
  await playWord(rmW[rmI]);
  if(!ABORT){pbIdle('rm-pbtn','–ï—â—ë —Ä–∞–∑');setMsg('rm-msg','–ü–æ–≤—Ç–æ—Ä–∏ –∫–ª—é—á–æ–º ‚Üì');}
}
function rmAdd(s){
  rmM+=s;rPills('rm-pills',rmM);document.getElementById('rm-dec').textContent=decodeMorse(rmM);
  clearTimeout(rmT);rmT=setTimeout(()=>{if(rmM&&!rmM.endsWith(' ')){rmM+=' ';rPills('rm-pills',rmM);}},450);
}
function rmClear(){clearTimeout(rmT);rmM='';rPills('rm-pills','');document.getElementById('rm-dec').textContent='';}
function rmCheck(){
  clearTimeout(rmT);
  if(!rmM.trim()){setMsg('rm-msg','–í–≤–µ–¥–∏ –º–æ—Ä–∑–µ –∫–ª—é—á–æ–º!','err');return;}
  const tgt=wordMorse(rmW[rmI]),usr=rmM.trim().replace(/\s+/g,' ');
  if(usr===tgt){setMsg('rm-msg','‚úì –í–µ—Ä–Ω–æ!','ok');setTimeout(()=>{rmI++;rmNext();},900);}
  else{setMsg('rm-msg','‚úó –í–µ—Ä–Ω–æ: '+tgt,'err');rPills('rm-pills',tgt);setTimeout(()=>{rmI++;rmNext();},2400);}
}
function rmNext(){
  clearTimeout(rmT);rmM='';rPills('rm-pills','');document.getElementById('rm-dec').textContent='';
  document.getElementById('rm-prog').style.width=(rmI/rmW.length*100)+'%';
  if(rmI>=rmW.length){setMsg('rm-msg','üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ!','ok');rChips('rm-chips',rmW,rmI);return;}
  rChips('rm-chips',rmW,rmI);setMsg('rm-msg','–ù–∞–∂–º–∏ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏');pbIdle('rm-pbtn');
}

// ‚îÄ‚îÄ RECV COMBO ‚îÄ‚îÄ
let rcW=[],rcI=0,rcM='',rcT=null;
function rcInit(){
  ABORT=true;clearTimeout(rcT);rcW=rndSet();rcI=0;rcM='';
  rChips('rc-chips',rcW,rcI);
  rPills('rc-pills','');document.getElementById('rc-mdec').textContent='';
  const i=document.getElementById('rc-inp');i.value='';i.className='linput';
  setMsg('rc-msg','–ù–∞–∂–º–∏ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏');
  document.getElementById('rc-prog').style.width='0%';
  pbIdle('rc-pbtn');
  attachKey(document.getElementById('rc-key'),()=>rcAdd('.'),()=>rcAdd('-'));
}
async function rcPlay(){
  if(rcI>=rcW.length)return;
  ABORT=false;pbBusy('rc-pbtn');setMsg('rc-msg','–°–ª—É—à–∞–π...');
  await playWord(rcW[rcI]);
  if(!ABORT){pbIdle('rc-pbtn','–ï—â—ë —Ä–∞–∑');setMsg('rc-msg','–í–≤–µ–¥–∏ –º–æ—Ä–∑–µ –∏ –ø–µ—Ä–µ–≤–æ–¥');}
}
function rcAdd(s){
  rcM+=s;rPills('rc-pills',rcM);document.getElementById('rc-mdec').textContent=decodeMorse(rcM);
  clearTimeout(rcT);rcT=setTimeout(()=>{if(rcM&&!rcM.endsWith(' ')){rcM+=' ';rPills('rc-pills',rcM);}},450);
}
function rcClear(){clearTimeout(rcT);rcM='';rPills('rc-pills','');document.getElementById('rc-mdec').textContent='';}
function rcCheck(){
  clearTimeout(rcT);
  const tgt=rcW[rcI],tgtM=wordMorse(tgt);
  const usrM=rcM.trim().replace(/\s+/g,' ');
  const usrL=document.getElementById('rc-inp').value.trim().toUpperCase().replace(/[^–ê-–Ø–Å]/g,'');
  const mOk=usrM===tgtM,lOk=usrL===tgt;
  const inp=document.getElementById('rc-inp');
  if(mOk&&lOk){inp.className='linput ok';setMsg('rc-msg','‚úì –û–±–∞ –≤–µ—Ä–Ω–æ!','ok');setTimeout(()=>{rcI++;rcNext();},900);}
  else{
    inp.className='linput err';
    let m='‚úó ';if(!mOk)m+='–ú–æ—Ä–∑–µ: '+tgtM+'  ';if(!lOk)m+='–°–ª–æ–≤–æ: '+tgt;
    setMsg('rc-msg',m,'err');if(!mOk)rPills('rc-pills',tgtM);
    setTimeout(()=>{rcI++;rcNext();},2600);
  }
}
function rcSkip(){setMsg('rc-msg','–ü—Ä–æ–ø—É—â–µ–Ω–æ: '+rcW[rcI],'err');rcI++;setTimeout(rcNext,1100);}
function rcNext(){
  clearTimeout(rcT);rcM='';rPills('rc-pills','');document.getElementById('rc-mdec').textContent='';
  const i=document.getElementById('rc-inp');i.value='';i.className='linput';
  document.getElementById('rc-prog').style.width=(rcI/rcW.length*100)+'%';
  if(rcI>=rcW.length){setMsg('rc-msg','üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–æ!','ok');rChips('rc-chips',rcW,rcI);return;}
  rChips('rc-chips',rcW,rcI);setMsg('rc-msg','–ù–∞–∂–º–∏ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏');pbIdle('rc-pbtn');
}
document.getElementById('rc-inp').addEventListener('input',function(){this.value=this.value.toUpperCase().replace(/[^–ê-–Ø–Å]/g,'')});

// Prevent double-tap zoom
document.addEventListener('dblclick',e=>e.preventDefault(),{passive:false});
// Build ref on load
refBuild();
</script>
</body>
</html>
